<!DOCTYPE html>
        
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->

<title>Creating a Lifestream Widget with YQL - Max Manders</title>
        
<meta charset="UTF-8" />
<meta name="keywords" content="" />
<meta name="author" content="Max Manders" />
        
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- Mobile Specific Metas
================================================== -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- CSS
================================================== -->
<link rel="stylesheet" href="/styles/stylesheets/base.css">
<link rel="stylesheet" href= "/styles/style.css">
<link rel="stylesheet" href="/styles/stylesheets/layout.css">
<link rel="stylesheet" href="/styles/highlight.css">
<link href='http://fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>

<!-- Favicons
================================================== -->
<link rel="shortcut icon" href="/favicon.ico" />

</head>

<body class="home blog">

<div class="container">

<div class="header">    
  <div class="seven columns"> 
    <div class="logo">
      <a href="/">
        <h1 class="remove-bottom">Max Manders</h1>
        <h5>thoughts of a web developer</h5>
      </a>
    </div>
  </div> 
</div>

<div class="content">
  <div class="column">
    <div class="main">
      <article class="post">
  <h3 class="post-title"><a href="/2010/08/26/creating-a-lifestream-widget-with-yql.html" title="Creating a Lifestream Widget with YQL">Creating a Lifestream Widget with YQL</a></h3>
  <span class="post-date"><abbr class="published-on">August 26, 2010</abbr></span>
  <div class="post-content">
    <p><h3>What is YQL?</h3>
<p>The Yahoo! Query Language (YQL) is a fantastic web service from the Yahoo! Developer Network (YDN) that can dramatically speed up development time if your application involves requesting data from multiple disparate web services and somehow combining that data.&#160; You can think of YQL as a gateway API that allows you to quickly and easily select, filter and combine data from across the web.<!--more--> <h3>How to Use it</h3> Although YQL is a Yahoo! hosted web service that you will ultimately need to query programatically you can start using it without reading much (if any) documentation thanks to the wonderfully designed <a href='http://developer.yahoo.com/yql/console/' title='YQL Console'>YQL console</a>.</p>

<p><span>caption id=&#8221;attachment_205&#8221; align=&#8221;alignnone&#8221; width=&#8221;300&#8221; caption=&#8221;Screenshot of the YQL console.&#8221;</span><img src='/media/yqlconsole-300x175.png' width='300' height='175' alt='Screenshot of the YQL console.' class='size-medium wp-image-205' title='Screenshot of the YQL console.' /><span>/caption</span></p>

<p>The console is arranged in three main areas: the query input at the top; the results at the bottom; and a list of available tables and examples at the right.&#160; From the menu on the right, you can click on a table name and an example query will be inserted into the query input box and executed.&#160; Browsing through the tables and trying the example queries should give you a feel for the console. <h3>An Example</h3> As an example, let&#8217;s say you want to find some photos of kittens from Flickr. <pre class='brush:sql'>select * from flickr.photos.search where text = 'kitten'</pre> If you paste this into the input box and hit <em>enter</em> (or click <em>Test</em>) you will see the results appear in the results window, and a REST URL appear beneath that.&#160; The REST URL will be used shortly when we see how to use YQL in PHP.&#160; You can select either XML or JSON for the return data, and there&#8217;s also a handy tree view to show you the results in a hierarchical tree structure.</p>

<p><span>caption id=&#8221;attachment_229&#8221; align=&#8221;alignnone&#8221; width=&#8221;300&#8221; caption=&#8221;Searching for Flickr Kittens&#8221;</span><img src='/media/yqlconsole-kitten-300x175.png' width='300' height='175' alt='Searching for Flickr Kittens' class='size-medium wp-image-229' title='Searching for Flickr Kittens' /><span>/caption</span></p>

<p>By default, YQL only show tables for Yahoo! owned sites.&#160; However, the YQL project is extensible and community contribution is actively encouraged; more on this later.&#160; To see the complete list of tables, click the &#8216;Show Community Tables&#8217; link.&#160; You could search Google for YQL: <pre class='brush:sql'>select titleNoFormatting, url, content, visibleUrl from google.search where q = 'yql'</pre> There are even tables like html and rss to allow you to easily parse valid markup and RSS feeds. <h3>Mixing in Some PHP</h3> The YQL console is great for trying out queries and seeing how they work, but now we want to harness the power of YQL in some server-side code.&#160; For the most part this involves getting a URL from the console, and stirring in some cURL. <pre style='border: solid 3px red; background-color: pink' class='markdown-html-error'>REXML could not parse this XML/HTML: 
&lt;pre class=&quot;brush:php&quot;&gt;// Our query.
$yql = &apos;select * from flickr.photos.search where text = &apos;kitten&apos;&apos;;</pre></p>

<p>// Build a REST URL. $url = &#8216;http://query.yahooapis.com/v1/public/yql?q=&#8217; . urlencode($yql);</p>

<p>// Some cURL goodness. $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);</p>

<p>// &#8230;and execute. $data = curl_exec($ch); curl_close($ch);</p>

<p>// What did we get? echo &#8217;<pre>';
print_r($data);
echo '</pre>&#8217;; &lt;/pre&gt; The returned XML is wrapped in a <code>query</code> element that has some useful metadata; but what we&#8217;re interested in is the <code>results</code> element. <h3>Creating a Lifestream</h3> You can view a <a href='http://maxmanders.co.uk/lab/lifestream/'>live demo of my lifestream</a>, which pulls in content from this blog, Flickr, Twitter, Delicious and LastFM.&#160; I&#8217;ve made it pretty using some CSS and JQuery (Hoverscroll Plugin).&#160; I&#8217;ve also borrowed from the YIU toolbox using the <a href='http://developer.yahoo.com/yui/grids/'>YUI grids builder</a> to quickly throw together a layout.</p>

<p>The important bits of code follow, together with an explanation.&#160; You can find <a href='http://github.com/maxmanders/YQL-Lifestream'>all the code on github</a>.&#160; First we build our YQL query and get the data. <pre style='border: solid 3px red; background-color: pink' class='markdown-html-error'>REXML could not parse this XML/HTML: 
&lt;pre class=&quot;brush:php&quot;&gt;$yql = &apos;SELECT title &apos;
. &apos;, link &apos;
. &apos;, pubDate &apos;
. &apos;, date &apos;
. &apos;FROM rss &apos;
. &apos;WHERE url IN ( &apos;
.   &apos;\&apos;http://maxmanders.co.uk/feed\&apos;, &apos;
.   &apos;\&apos;http://feeds.delicious.com/v2/rss/maxmanders\&apos;, &apos;
.   &apos;\&apos;http://www.flickr.com/services/feeds/photos_public.gne?id=52727640@N00&amp;amp;format=rss_200\&apos; ,&apos;
.   &apos;\&apos;http://ws.audioscrobbler.com/1.0/user/mmanders/recenttracks.rss\&apos;, &apos;
.   &apos;\&apos;http://twitter.com/statuses/user_timeline/623503.rss\&apos;) &apos;
. &apos;| SORT(field=&quot;pubDate&quot;, descending=&quot;true&quot;)&apos;;</pre></p>

<p>$endpoint = &#8216;http://query.yahooapis.com/v1/public/yql?format=json&#38;env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&#38;diagnostics=false&#8217;; $url = $endpoint . &#8217;&#38;q=&#8217; . urlencode($yql);</p>

<p>$ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($ch, CURLOPT_SET_VERIFYHOST, false);</p>

<p>$data = json_decode(curl_exec($ch)); curl_close($ch); $data = $data-&gt;query-&gt;results-&gt;item; &lt;/pre&gt; First we build a query to select from the <em>rss</em> table.&#160; This table models an RSS feed, and makes it easy to select common RSS fields.&#160; We use the syntax <code>WHERE url IN</code> to aggregate RSS feeds from multiple sources.&#160; Once we have the data, we want to sort the combined feed in descending order of publishing date.&#160; We can then iterate over the data, <a href='http://github.com/maxmanders/YQL-Lifestream/blob/master/index.php'>and output a nice well structured table</a> (via GitHub). <div style='position: absolute; left: -10000px; top: 504px; width: 1px; height: 1px; overflow: hidden;' id='_mcePaste'><img src='file:///tmp/moz-screenshot.png' alt='' /></div></p></p>
  </div>
</article>

<div id="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'maxmanders';
    var disqus_identifier = '/2010/08/26/creating-a-lifestream-widget-with-yql';
    var disqus_url = 'http://maxmanders.co.uk//2010/08/26/creating-a-lifestream-widget-with-yql.html';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
</div>



      <div class="nav-below"> 
        
          <div class="nav-previous"></div>
        
        
          <div class="nav-next"></div>
        
      </div>
    </div>
  </div>
<!-- nav -->
</div>

<div class="clear"></div>
<div class="footer">
  <div class="column">
    <div class="row">
      <div class="eight columns alpha">
      <h4>About Me</h4>
      <p><a href="/about.html">I'm</a> an Edinburgh based PHP developer with a passion for <a href="http://en.wikipedia.org/wiki/Open_source">open source software</a> and <a href="http://en.wikipedia.org/wiki/Open_data">open-data</a>, currently working for <a href="http://maglabs.net" rel="co-worker met">Maglabs</a>. Living with my wife <a href="http://twitter.com/mrsjmanders" rel="met spouse">Jo</a> and our two cats, Ziggy and Maggie.</p>
      <p><a href="/about.html">Continue reading</a></p>
      <h4>Contact</h4>
      <p>If you want to get in touch, you can send an email to my-first-name [at] this site.</p>
      </div>
      <div class="eight columns omega">
        <div class="row">
          <div class="four columns alpha">
            <ul>
              <li>
                <img alt="Pinboard" src="/images/link.png" />
                <a href="http://www.pinboard.in/u:maxmanders/" title="maxmanders on Pinboard">Pinboard</a>
              </li>
              <li>
                <img alt="Flickr" src="/images/picture.png" />
                <a href="http://www.flickr.com/photos/maxmanders" title="maxmanders on Flickr">Flickr</a>
              </li>
              <li>
                <img alt="Last.FM" src="/images/song.png" />
                <a href="http://www.last.fm/user/mmanders" title="mmanders on Last.FM">Last.FM</a>
              </li>
              <li>
                <img alt="Twitter" src="/images/message.png" />
                <a href="http://www.twitter.com/maxmanders" title="maxmanders on Twitter">Twitter</a>
              </li>
              <li>
                <img alt="Github" src="/images/github.png" />
                <a href="http://www.github.com/maxmanders" title="maxmanders on Github">Github</a>
              </li>
              <li>
                <img alt="RSS" src="/images/maxmanders.png" />
                <a href="http://maxmanders.co.uk/feed/rss2" title="maxmanders.co.uk RSS">RSS</a>
              </li>
            </ul>
          </div>
          <div class="four columns omega">

          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="column alpha" id="license">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons Licence" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a>
        <span>&nbsp; This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.</span>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
  var pageTracker = _gat._getTracker("UA-1652642-1");
  pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
</html>
